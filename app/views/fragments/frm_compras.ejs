<script>
  function mostrar() {
    console.log("aqui toy");
    var url = "http://localhost:3000/listarCompras";
    $.ajax({
      url: url,
      type: "GET",
      dataType: "json",
      success: function (data, textStatus, jqXHR) {
        console.log(data , "dataaaa");
        cargarTabla(data);
      },
      error: function (jqXHR, textStatus, errorThrown) {
        console.log(jqXHR);
      },
    });
  }

  function cargarTabla(data) {
    var tableBody = $("#tb");
    tableBody.empty(); // Limpia la tabla antes de llenarla

    console.log("Datos recibidos:", data); // Imprime la data recibida en la consola

    data.forEach(function (compra) {
        console.log("Compra:", compra); // Imprime cada compra en la consola

        var row = `<tr>
            <td>${compra.fecha}</td>
            <td>${compra.persona.nombre}</td>
            <td>${compra.detallesVino.map(detalle => detalle.vino.nombre).join(', ')}</td>
            <td>${compra.detallesVino.map(detalle => detalle.cantidad).join(', ')}</td>
            <td>${compra.total}</td>
        </tr>`;
        tableBody.append(row);
    });
}

  $(document).ready(function () {
    mostrar();
  });
</script>

<!-- Alertas -->
<% if(locals.flash){ %>
<div class="alert alert-info"><%- locals.flash %></div>
<% } %>
<!-- /Alertas -->

<!-- Tabla -->
<div class="card mb-3">
  <div class="card-header">
    <i class="fas fa-shopping-cart"></i>
    Visualizaci贸n de compras
  </div>
  <div class="card-body">
    <div class="table-responsive">
      <table
        class="table table-bordered"
        id="dataTable"
        width="100%"
        cellspacing="0"
      >
        <thead>
          <tr>
            <th>Fecha de compra</th>
            <th>C贸digo de cliente</th>
            <th>Producto</th>
            <th>Cantidad</th>
            <th>Precio total</th>
          </tr>
        </thead>
        <tfoot>
          <tr>
            <th>Fecha de compra</th>
            <th>C贸digo de cliente</th>
            <th>Producto</th>
            <th>Cantidad</th>
            <th>Precio total</th>
          </tr>
        </tfoot>
        <tbody id="tb"></tbody>
      </table>
    </div>
  </div>
  <div class="card-footer small text-muted">
    Visualizaci贸n Compras - Santos Licores
  </div>
</div>
<!-- Tabla -->
