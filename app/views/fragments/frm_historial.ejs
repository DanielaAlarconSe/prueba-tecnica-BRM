<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historial de Compras</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

<!-- Alertas -->
<!-- Aquí puedes incluir tus alertas si es necesario -->

<!-- Tabla -->
<div class="card mb-3 mt-4">
    <div class="card-header">
        <i class="fas fa-shopping-cart"></i>
        Visualización de compras
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                <thead>
                    <tr>
                        <th>Fecha de compra</th>
                        <th>Producto</th>
                        <th>Cantidad</th>
                        <th>Precio total</th>
                    </tr>
                </thead>
                <tfoot>
                    <tr>
                        <th>Fecha de compra</th>
                        <th>Producto</th>
                        <th>Cantidad</th>
                        <th>Precio total</th>
                    </tr>
                </tfoot>
                <tbody><% listaCompra.forEach(compra => { %>
                    <tr>
                        <td><%= compra.fecha %></td>
                        <td><%= compra.producto %></td>
                        <td><%= compra.cantidad %></td>
                        <td><%= compra.total %></td>
                    </tr>
                <% }) %></tbody>
            </table>
        </div>
    </div>
    <div class="card-footer small text-muted">
        Historial Compras - Santos Licores
    </div>
</div>
<!-- Tabla -->

<script>
  function mostrar() {
    const url = "http://localhost:3000/listarComprasUsuario"; // La ruta para obtener las compras del usuario autenticado

    $.ajax({
      url: url,
      type: "GET",
      dataType: "json",
      success: function (data, textStatus, jqXHR) {
        console.log(data, "dataaaa");
        cargarTabla(data);
      },
      error: function (jqXHR, textStatus, errorThrown) {
        console.log(jqXHR);
      },
    });
  }

  function cargarTabla(data) {
    var tableBody = $("#tb");
    tableBody.empty(); // Limpia la tabla antes de llenarla

    console.log("Datos recibidos:", data); // Imprime la data recibida en la consola

    data.forEach(function (compra) {
        console.log("Compra:", compra); // Imprime cada compra en la consola

        var row = `<tr>
            <td>${new Date(compra.fecha).toLocaleDateString()}</td>
            <td>${compra.persona}</td>
            <td>${compra.producto}</td>
            <td>${compra.cantidad}</td>
            <td>${compra.total.toLocaleString()}</td>
        </tr>`;
        tableBody.append(row);
    });
  }

  $(document).ready(function () {
    mostrar(); // Mostrar datos al cargar la página
  });
</script>

</body>
</html>
